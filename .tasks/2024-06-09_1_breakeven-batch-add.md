# 背景
文件名：2024-06-09_1_breakeven-batch-add.md
创建于：2024-06-09_XX:XX:XX
创建者：76090
主分支：main
任务分支：task/breakeven-batch-add_2024-06-09_1
Yolo模式：Off

# 任务描述
实现批量加仓时自动计算每单手数，使所有同品种同方向持仓在新止损价止损时整体盈亏尽量为0，并将该手数应用于本次批量下单的每一单。

# 项目概览
本项目为MT5交易系统，支持批量下单、持仓管理、风险控制等功能。当前批量下单手数为独立计算，未考虑加仓后整体盈亏平衡。

⚠️ 警告：永远不要修改此部分 ⚠️
[此部分应包含核心RIPER-5协议规则的摘要，确保它们可以在整个执行过程中被引用]
⚠️ 警告：永远不要修改此部分 ⚠️

# 分析
- 当前批量下单手数为独立计算，未考虑已有持仓。
- 需在批量下单前统计同品种同方向持仓，结合新止损价和批量下单参数，统一计算每单手数。
- 需兼容市价单与挂单，异常情况需提示用户。

# 提议的解决方案
采用"批量下单前统一计算法"，在批量下单时自动统计持仓并计算盈亏平衡手数，填充到每单手数参数中。

# 当前执行步骤："1. 在MT5Trader中确认/补充获取所有持仓的接口，支持按品种和方向筛选"

# 任务进度
[带时间戳的变更历史]

# 最终审查
[完成后的总结]
